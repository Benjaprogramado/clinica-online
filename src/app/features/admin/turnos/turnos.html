<div class="turnos-admin-container">
  <div class="container py-5">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">
        <i class="pi pi-calendar me-2"></i>
        Gestión de Turnos
      </h2>
    </div>

    <!-- Filtros -->
    <div class="card custom-card mb-4">
      <div class="card-body">
        <div class="row g-3">
          <!-- Filtro Estado -->
          <div class="col-12 col-md-6 col-lg-2">
            <label class="form-label fw-bold">Estado</label>
            <div class="d-flex flex-wrap gap-2">
              <button
                type="button"
                class="btn btn-sm"
                [class.btn-primary]="filtros().estado === 'todos'"
                [class.btn-outline-primary]="filtros().estado !== 'todos'"
                (click)="aplicarFiltroEstado('todos')">
                Todos
              </button>
              @for (estado of estados; track estado) {
                <button
                  type="button"
                  class="btn btn-sm"
                  [class.btn-primary]="filtros().estado === estado"
                  [class.btn-outline-primary]="filtros().estado !== estado"
                  (click)="aplicarFiltroEstado(estado)">
                  {{ obtenerTextoEstado(estado) }}
                </button>
              }
            </div>
          </div>

          <!-- Filtro Especialidad -->
          <div class="col-12 col-md-6 col-lg-3">
            <label class="form-label fw-bold">Especialidad</label>
            <input
              type="text"
              class="form-control"
              [ngModel]="filtros().especialidad"
              (ngModelChange)="aplicarFiltroEspecialidad($event)"
              placeholder="Buscar por especialidad...">
          </div>

          <!-- Filtro Búsqueda -->
          <div class="col-12 col-md-6 col-lg-3">
            <label class="form-label fw-bold">Buscar</label>
            <input
              type="text"
              class="form-control"
              [ngModel]="filtros().textoBusqueda"
              (ngModelChange)="aplicarFiltroBusqueda($event)"
              placeholder="Buscar por nombre o DNI...">
          </div>

          <!-- Filtro Fecha Desde -->
          <div class="col-12 col-md-6 col-lg-2">
            <label class="form-label fw-bold">Desde</label>
            <input
              type="date"
              class="form-control"
              [value]="filtros().fechaDesde ? formatearFechaParaInput(filtros().fechaDesde!) : ''"
              (change)="aplicarFiltroFechaDesde($any($event.target).value)">
          </div>

          <!-- Filtro Fecha Hasta -->
          <div class="col-12 col-md-6 col-lg-2">
            <label class="form-label fw-bold">Hasta</label>
            <input
              type="date"
              class="form-control"
              [value]="filtros().fechaHasta ? formatearFechaParaInput(filtros().fechaHasta!) : ''"
              (change)="aplicarFiltroFechaHasta($any($event.target).value)">
          </div>

          <!-- Botón Limpiar -->
          <div class="col-12 col-md-6 col-lg-1">
            <label class="form-label fw-bold d-block">&nbsp;</label>
            <button
              type="button"
              class="btn btn-outline-secondary w-100"
              (click)="limpiarFiltros()">
              <i class="pi pi-times"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabla de Turnos -->
    @if (turnosFiltrados().length === 0) {
      <div class="alert alert-info">
        <i class="pi pi-info-circle me-2"></i>
        No hay turnos para mostrar.
      </div>
    } @else {
      <div class="table-responsive">
        <table class="table table-dark table-hover">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Hora</th>
              <th>Paciente</th>
              <th>Especialista</th>
              <th>Especialidad</th>
              <th>Estado</th>
              <th>Reseña</th>
            </tr>
          </thead>
          <tbody>
            @for (turno of turnosFiltrados(); track turno.id) {
              <tr>
                <td>{{ turno.fecha | date:'dd/MM/yyyy' }}</td>
                <td>{{ turno.hora }}</td>
                <td>
                  {{ turno.pacienteNombre }} {{ turno.pacienteApellido }}<br>
                  <small class="text-muted">DNI: {{ turno.pacienteDNI }}</small>
                </td>
                <td>
                  {{ turno.especialistaNombre }} {{ turno.especialistaApellido }}
                </td>
                <td>{{ turno.especialidad }}</td>
                <td>
                  <span class="badge" [ngClass]="'bg-' + obtenerColorEstado(turno.estado)">
                    {{ obtenerTextoEstado(turno.estado) }}
                  </span>
                </td>
                <td>
                  @if (turno.resena) {
                    <div>
                      @for (i of [1,2,3,4,5]; track i) {
                        <i class="pi" [class.pi-star-fill]="i <= turno.resena!.calificacion" [class.pi-star]="i > turno.resena!.calificacion" [class.text-warning]="i <= turno.resena!.calificacion"></i>
                      }
                    </div>
                    <small>{{ turno.resena.comentario }}</small>
                  } @else {
                    <span class="text-muted">-</span>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>
</div>
