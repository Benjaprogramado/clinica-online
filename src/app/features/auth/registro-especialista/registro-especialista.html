<div class="registro-especialista-form">
  <form [formGroup]="registroForm" (ngSubmit)="onSubmit()">
    
    <div class="form-group">
      <label for="nombre">Nombre *</label>
      <input
        type="text"
        id="nombre"
        formControlName="nombre"
        [class.invalid]="isFieldInvalid('nombre')"
        placeholder="Ingresa tu nombre"
      >
      <div class="error-message" *ngIf="isFieldInvalid('nombre')">
        El nombre es requerido (mínimo 2 caracteres)
      </div>
    </div>

    <div class="form-group">
      <label for="apellido">Apellido *</label>
      <input
        type="text"
        id="apellido"
        formControlName="apellido"
        [class.invalid]="isFieldInvalid('apellido')"
        placeholder="Ingresa tu apellido"
      >
      <div class="error-message" *ngIf="isFieldInvalid('apellido')">
        El apellido es requerido (mínimo 2 caracteres)
      </div>
    </div>

    <div class="form-group">
      <label for="edad">Edad *</label>
      <input
        type="number"
        id="edad"
        formControlName="edad"
        [class.invalid]="isFieldInvalid('edad')"
        placeholder="Tu edad"
        min="18"
        max="80"
      >
      <div class="error-message" *ngIf="isFieldInvalid('edad')">
        La edad debe estar entre 18 y 80 años
      </div>
    </div>

    <div class="form-group">
      <label for="dni">DNI *</label>
      <input
        type="text"
        id="dni"
        formControlName="dni"
        [class.invalid]="isFieldInvalid('dni')"
        placeholder="Tu DNI sin puntos"
        maxlength="8"
      >
      <div class="error-message" *ngIf="isFieldInvalid('dni')">
        El DNI debe tener entre 7 y 8 dígitos
      </div>
    </div>

    <div class="especialidades-section">
      <h4>Especialidades *</h4>
      <div class="especialidades-grid">
        <div
          *ngFor="let esp of especialidadesDisponibles"
          class="especialidad-item"
          [class.selected]="especialidadesSeleccionadas.includes(esp)"
          (click)="toggleEspecialidad(esp)"
        >
          {{ esp }}
        </div>
      </div>
      
      <div class="nueva-especialidad">
        <input
          type="text"
          [(ngModel)]="nuevaEspecialidad"
          [ngModelOptions]="{standalone: true}"
          placeholder="Agregar nueva especialidad"
          (keyup.enter)="agregarNuevaEspecialidad()"
        >
        <button type="button" (click)="agregarNuevaEspecialidad()" [disabled]="!nuevaEspecialidad.trim()">
          <i class="pi pi-plus"></i>
        </button>
      </div>
      <p class="info-text">
        <i class="pi pi-info-circle"></i>
        Las especialidades que agregues estarán disponibles para futuros registros.
      </p>
    </div>

    <div class="form-group">
      <label for="email">Email *</label>
      <input
        type="email"
        id="email"
        formControlName="email"
        [class.invalid]="isFieldInvalid('email')"
        placeholder="tu@email.com"
      >
      <div class="error-message" *ngIf="isFieldInvalid('email')">
        Ingresa un email válido
      </div>
    </div>

    <div class="form-group">
      <label for="password">Contraseña *</label>
      <input
        type="password"
        id="password"
        formControlName="password"
        [class.invalid]="isFieldInvalid('password')"
        placeholder="Mínimo 6 caracteres"
      >
      <div class="error-message" *ngIf="isFieldInvalid('password')">
        La contraseña debe tener al menos 6 caracteres
      </div>
    </div>

    <div class="form-group">
      <label for="confirmarPassword">Confirmar Contraseña *</label>
      <input
        type="password"
        id="confirmarPassword"
        formControlName="confirmarPassword"
        [class.invalid]="isFieldInvalid('confirmarPassword')"
        placeholder="Repite tu contraseña"
      >
      <div class="error-message" *ngIf="isFieldInvalid('confirmarPassword')">
        Las contraseñas no coinciden
      </div>
    </div>

    <div class="imagen-upload">
      <label class="upload-label">
        <i class="pi pi-image"></i>
        <span>Imagen de perfil *</span>
        <input
          type="file"
          accept="image/*"
          (change)="onImagenSeleccionada($event)"
        >
      </label>
      <div class="preview" *ngIf="imagenPreview()">
        <img [src]="imagenPreview()" alt="Preview">
      </div>
    </div>

    <!-- reCAPTCHA -->
    <div class="form-group">
      <label class="form-label">Verificación de seguridad <span class="text-danger">*</span></label>
      <app-recaptcha (captchaValidado)="onCaptchaValidado($event)"></app-recaptcha>
    </div>

    <button
      type="submit"
      class="btn-submit"
      [disabled]="cargando() || registroForm.invalid || especialidadesSeleccionadas.length === 0 || !captchaValido()"
    >
      <span *ngIf="!cargando()">Registrarse</span>
      <span *ngIf="cargando()">
        <i class="pi pi-spin pi-spinner"></i> Registrando...
      </span>
    </button>

  </form>
</div>
