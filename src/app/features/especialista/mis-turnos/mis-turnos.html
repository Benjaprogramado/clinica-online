<div class="turnos-especialista">
  <div class="header">
    <div class="header-title">
      <h1>Mis Turnos</h1>
    </div>

    <div class="filtros">
      <div class="filtro-group filtro-estado">
        <label>Estado</label>
        <div class="estado-buttons">
          <button type="button" [class.activo]="filtros().estado === 'todos'" (click)="aplicarFiltroEstado('todos')">
            Todos
          </button>
          @for (estado of estados; track estado) {
            <button type="button" [class.activo]="filtros().estado === estado" (click)="aplicarFiltroEstado(estado)">
              {{ obtenerTextoEstado(estado) }}
            </button>
          }
        </div>
      </div>

      <div class="filtro-group">
        <label>Especialidad</label>
        <input
          type="text"
          [value]="filtros().especialidad"
          (input)="aplicarFiltroEspecialidad($any($event.target).value)"
          placeholder="Buscar por especialidad..." />
      </div>

      <div class="filtro-group">
        <label>Buscar Paciente</label>
        <input
          type="text"
          [value]="filtros().textoBusqueda"
          (input)="aplicarFiltroBusqueda($any($event.target).value)"
          placeholder="Nombre, apellido o DNI..." />
      </div>

      <div class="filtro-group limpiar">
        <label>&nbsp;</label>
        <button type="button" (click)="limpiarFiltros()">
          <i class="pi pi-times"></i>
          Limpiar
        </button>
      </div>
    </div>
  </div>

  @if (turnosFiltrados().length === 0) {
    <div class="empty-state">
      <i class="pi pi-info-circle"></i>
      <p>No hay turnos para mostrar.</p>
    </div>
  } @else {
    <div class="tarjetas-turnos">
      @for (turno of turnosFiltrados(); track turno.id) {
        <div class="tarjeta-turno">
          <div class="tarjeta-top">
            <span class="estado-badge" [ngClass]="obtenerColorEstado(turno.estado)">
              {{ obtenerTextoEstado(turno.estado) }}
            </span>
            <span class="fecha">{{ turno.fecha | date:'dd/MM/yyyy' }}</span>
          </div>

          <div class="tarjeta-body">
            <h3>{{ turno.especialidad }}</h3>
            <p>
              <strong>Paciente</strong>
              <span>{{ turno.pacienteNombre }} {{ turno.pacienteApellido }}</span>
              <span class="detalle">DNI: {{ turno.pacienteDNI }}</span>
            </p>
            <p>
              <strong>Hora</strong>
              <span>{{ turno.hora }}</span>
            </p>
            @if (turno.pacienteObraSocial) {
              <p>
                <strong>Obra social</strong>
                <span>{{ turno.pacienteObraSocial }}</span>
              </p>
            }
            @if (turno.comentarioPaciente) {
              <p class="comentario">
                <strong>Comentario del paciente</strong>
                <span>{{ turno.comentarioPaciente }}</span>
              </p>
            }
            @if (turno.comentarioEspecialista) {
              <p class="comentario-especialista">
                <strong>Tu comentario</strong>
                <span>{{ turno.comentarioEspecialista }}</span>
              </p>
            }
            @if (turno.resena) {
              <div class="resena">
                <strong>Rese√±a</strong>
                <div class="estrellas">
                  @for (i of [1,2,3,4,5]; track i) {
                    <i class="pi" [class.pi-star-fill]="i <= turno.resena!.calificacion" [class.pi-star]="i > turno.resena!.calificacion"></i>
                  }
                </div>
                <span class="comentario-resena">{{ turno.resena.comentario }}</span>
              </div>
            }
          </div>

          <div class="tarjeta-footer">
            <div class="acciones">
              @if (turno.estado === 'pendiente') {
                <button type="button" class="btn-accion positivo" (click)="aceptarTurno(turno)">
                  <i class="pi pi-check"></i>
                  Aceptar
                </button>
                <button type="button" class="btn-accion negativo" (click)="rechazarTurno(turno)">
                  <i class="pi pi-times"></i>
                  Rechazar
                </button>
              }
              @if (turno.estado === 'aceptado') {
                <button type="button" class="btn-accion neutro" (click)="cancelarTurno(turno)">
                  <i class="pi pi-times"></i>
                  Cancelar
                </button>
                <button type="button" class="btn-accion info" (click)="finalizarTurno(turno)">
                  <i class="pi pi-check-circle"></i>
                  Finalizar
                </button>
              }
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
